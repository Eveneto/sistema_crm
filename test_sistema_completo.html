<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Autentica√ß√£o Firebase</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { margin: 10px 5px; padding: 10px 15px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        #results { margin-top: 20px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üî• Teste do Sistema de Autentica√ß√£o Firebase + Django</h1>
    
    <div class="test-section info">
        <h3>üìä Status dos Servi√ßos</h3>
        <p><strong>Frontend React:</strong> <span id="frontend-status">Verificando...</span></p>
        <p><strong>Backend Django:</strong> <span id="backend-status">Verificando...</span></p>
        <p><strong>Firebase Config:</strong> <span id="firebase-status">Verificando...</span></p>
    </div>

    <div class="test-section">
        <h3>üß™ Testes Dispon√≠veis</h3>
        <button class="btn-primary" onclick="testBackendConnection()">1. Testar Conex√£o Backend</button>
        <button class="btn-primary" onclick="testFirebaseInit()">2. Testar Firebase Init</button>
        <button class="btn-success" onclick="testTokenService()">3. Testar Token Service</button>
        <button class="btn-warning" onclick="testApiInterceptor()">4. Testar API Interceptor</button>
        <button class="btn-danger" onclick="clearTests()">Limpar Testes</button>
    </div>

    <div id="results"></div>

    <script>
        // Fun√ß√£o para adicionar resultado de teste
        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-section ${type}`;
            resultDiv.innerHTML = `<h4>${title}</h4><pre>${content}</pre>`;
            resultsDiv.appendChild(resultDiv);
        }

        // Teste 1: Conex√£o com Backend
        async function testBackendConnection() {
            try {
                addResult('üîÑ Testando conex√£o com Django...', 'Enviando requisi√ß√£o para http://localhost:8000', 'warning');
                
                const response = await fetch('http://localhost:8000/auth/profile/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.status === 401) {
                    addResult('‚úÖ Backend Django', 'Conectado! (401 esperado - sem token)', 'success');
                } else {
                    addResult('‚úÖ Backend Django', `Status: ${response.status}`, 'success');
                }
                
                document.getElementById('backend-status').textContent = '‚úÖ Online';
            } catch (error) {
                addResult('‚ùå Erro no Backend', error.message, 'error');
                document.getElementById('backend-status').textContent = '‚ùå Offline';
            }
        }

        // Teste 2: Firebase Initialization
        function testFirebaseInit() {
            try {
                // Verifica se o Firebase est√° inicializado
                if (typeof window !== 'undefined') {
                    addResult('üîÑ Testando Firebase Init...', 'Verificando configura√ß√£o Firebase', 'warning');
                    
                    // Simula teste de inicializa√ß√£o
                    setTimeout(() => {
                        addResult('‚ö†Ô∏è Firebase Config', 'N√£o √© poss√≠vel testar Firebase diretamente neste contexto. Verifique o console do React app.', 'warning');
                    }, 1000);
                } else {
                    throw new Error('Window object n√£o dispon√≠vel');
                }
            } catch (error) {
                addResult('‚ùå Firebase Init Error', error.message, 'error');
            }
        }

        // Teste 3: Token Service
        function testTokenService() {
            addResult('üîÑ Testando Token Service...', 'Verificando localStorage para tokens Firebase', 'warning');
            
            const firebaseToken = localStorage.getItem('firebase_token');
            const userEmail = localStorage.getItem('user_email');
            const userName = localStorage.getItem('user_name');
            
            const result = {
                firebaseToken: firebaseToken ? 'Presente' : 'Ausente',
                userEmail: userEmail || 'N√£o encontrado',
                userName: userName || 'N√£o encontrado'
            };
            
            if (firebaseToken) {
                addResult('‚úÖ Token Service', JSON.stringify(result, null, 2), 'success');
            } else {
                addResult('‚ö†Ô∏è Token Service', JSON.stringify(result, null, 2), 'warning');
            }
        }

        // Teste 4: API Interceptor
        async function testApiInterceptor() {
            try {
                addResult('üîÑ Testando API Interceptor...', 'Testando requisi√ß√£o com headers customizados', 'warning');
                
                const testHeaders = {
                    'Content-Type': 'application/json',
                    'X-Test-Header': 'interceptor-test'
                };
                
                const response = await fetch('http://localhost:8000/auth/profile/', {
                    method: 'GET',
                    headers: testHeaders
                });
                
                addResult('‚úÖ API Interceptor', `Headers enviados: ${JSON.stringify(testHeaders, null, 2)}\\nStatus: ${response.status}`, 'success');
                
            } catch (error) {
                addResult('‚ùå API Interceptor Error', error.message, 'error');
            }
        }

        // Limpar testes
        function clearTests() {
            document.getElementById('results').innerHTML = '';
        }

        // Verificar status na inicializa√ß√£o
        window.onload = function() {
            document.getElementById('frontend-status').textContent = '‚úÖ Online';
            testBackendConnection();
        };
    </script>
</body>
</html>
